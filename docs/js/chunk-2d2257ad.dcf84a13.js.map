{"version":3,"sources":["webpack:///./src/views/Inbox.vue?7649","webpack:///src/views/Inbox.vue","webpack:///./src/views/Inbox.vue?309f","webpack:///./src/views/Inbox.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","tableData","tableColumns","staticRenderFns","component"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,QAAQ,CAACE,MAAM,CAAC,OAAS,GAAG,KAAO,SAAS,CAACF,EAAG,QAAQ,CAACG,YAAY,QAAQD,MAAM,CAAC,KAAO,KAAK,CAACF,EAAG,gBAAgB,CAACE,MAAM,CAAC,MAAQ,QAAQ,KAAON,EAAIQ,UAAU,QAAUR,EAAIS,iBAAiB,IAAI,IAAI,IACjTC,EAAkB,G,4HC4BtB,GACA,CACA,aACA,iBACA,kCACA,WAEA,CACA,gBACA,iBACA,mCAEA,CACA,aACA,sBACA,mBACA,YAIA,GACA,YACI,cAAJ,QAEA,KAJA,WAKA,OACA,aACA,iBAGA,SAEA,UAFA,WAEA,2KACA,0BACA,QAFA,uBAGA,eACA,6BAJA,iCAQA,sBACA,cACA,MACA,gBAXA,SAcA,UAdA,OAiBA,IAHA,EAdA,OAeA,4BACA,eACA,sBACA,OACA,WACA,8CACA,kBACA,oBACA,YACA,MACA,kBACA,mBAEA,oDAGA,sCA/BA,gDAkCA,QA9CA,WA+CA,kBAEA,OACA,4BADA,WAEA,qCACA,2CACA,GACA,oBCvG+U,I,YCO3UC,EAAY,eACd,EACAZ,EACAW,GACA,EACA,KACA,KACA,MAIa,aAAAC,E","file":"js/chunk-2d2257ad.dcf84a13.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('a-row',{attrs:{\"gutter\":24,\"type\":\"flex\"}},[_c('a-col',{staticClass:\"mb-24\",attrs:{\"span\":24}},[_c('CardMailTable',{attrs:{\"title\":\"Inbox\",\"data\":_vm.tableData,\"columns\":_vm.tableColumns}})],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!-- \n\tThis is the inbox page, it uses the dashboard layout in: \n\t\"./layouts/Dashboard.vue\" .\n -->\n\n<template>\n\t<div>\n\t\t<!-- Inbox Table -->\n\t\t<a-row :gutter=\"24\" type=\"flex\">\n\t\t\t<a-col :span=\"24\" class=\"mb-24\">\n\t\t\t\t<CardMailTable\n                    title=\"Inbox\"\n\t\t\t\t\t:data=\"tableData\"\n\t\t\t\t\t:columns=\"tableColumns\"\n\t\t\t\t></CardMailTable>\n\t\t\t</a-col>\n\t\t</a-row>\n\t</div>\n</template>\n\n<script>\n\timport { ethers } from \"ethers\";\n\timport MailServiceArtifact from \"../contracts/MailService.json\";\n\timport contractAddress from \"../contracts/contract-address.json\";\n\timport {formatDate} from '@/common/date'\n\n\timport CardMailTable from '../components/Cards/CardMailTable' ;\n\n\t// 表头\n\tconst tableColumns = [\n\t\t{\n\t\t\ttitle: 'FROM',\n\t\t\tdataIndex: 'from',\n\t\t\tscopedSlots: { customRender: 'from' },\n\t\t\twidth: 400\n\t\t},\n\t\t{\n\t\t\ttitle: 'SUMMARY',\n\t\t\tdataIndex: 'mail',\n\t\t\tscopedSlots: { customRender: 'mail' },\n\t\t},\n\t\t{\n\t\t\ttitle: 'DATE',\n\t\t\tdataIndex: 'timestamp',\n\t\t\tclass: 'text-muted',\n\t\t\twidth: 200\n\t\t},\n\t];\n\n\texport default ({\n\t\tcomponents: {\n            CardMailTable\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttableData: [],\n\t\t\t\ttableColumns: tableColumns\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\t// 加载收件箱\n\t\t\tasync loadInbox() {\n\t\t\t\tlet provider = this.$store.state.provider;\n\t\t\t\tif (provider == null) {\n\t\t\t\t\tthis.tableData = [];\n\t\t\t\t\tconsole.log(\"未连接钱包 无法加载收件箱\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 加载合约\n\t\t\t\tlet contract = new ethers.Contract(\n\t\t\t\t\tcontractAddress.MailService,\n\t\t\t\t\tMailServiceArtifact.abi,\n\t\t\t\t\tprovider.getSigner(0)\n\t\t\t\t);\n\t\t\t\t// 调用合约\n\t\t\t\tlet inbox = await contract.inbox();\n\t\t\t\tconsole.log(\"load inbox\", inbox);\n\t\t\t\tthis.tableData = [];\n\t\t\t\tfor (let i = inbox.length - 1; i >= 0; i--) {\n\t\t\t\t\tlet mail = inbox[i];\n\t\t\t\t\tlet date = new Date()\n              \t\tdate.setTime(Number(mail.timestamp.toString()) * 1000);\n\t\t\t\t\tthis.tableData.push({\n\t\t\t\t\t\tkey: mail.id.toString(),\n\t\t\t\t\t\tfrom: mail.from,\n\t\t\t\t\t\tmail: {\n\t\t\t\t\t\t\tsubject: mail.subject,\n\t\t\t\t\t\t\tcontent: mail.content\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttimestamp: formatDate(date, 'yyyy-MM-dd HH:mm:ss')\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.$store.commit(\"setInboxRefresh\", false);\n\t\t\t}\n\t\t},\n\t\tcreated() {\n\t\t\tthis.loadInbox();\n\t\t},\n\t\twatch: {\n\t\t\t'$store.state.inboxRefresh'() {\n\t\t\t\tlet isRefresh = this.$store.state.inboxRefresh;\n\t\t\t\tconsole.log(\"watch inboxRefresh change\", isRefresh);\n\t\t\t\tif (isRefresh) {\n\t\t\t\t\tthis.loadInbox();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n</script>\n\n<style lang=\"scss\">\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Inbox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Inbox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Inbox.vue?vue&type=template&id=87575d74&\"\nimport script from \"./Inbox.vue?vue&type=script&lang=js&\"\nexport * from \"./Inbox.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}